<!doctype html><html class="not-ready text-sm lg:text-base" style=--bg:#faf6f1 lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>PHP Design Patterns: Singleton Pattern - Wern Ancheta</title><meta name=theme-color><meta name=description content="This is the 13th post in a series of articles that will walk you through how to implement design patterns in PHP.
In this part, we&rsquo;re going to take a look at how you can implement the Singleton Pattern.
The Singleton Pattern is a creational design pattern for ensuring that you&rsquo;re only ever working with a single instance of a class. This makes it very predictable in terms of the values it handles."><meta name=author content="Wern Ancheta"><link rel="preload stylesheet" as=style href=https://anchetaWern.github.io/main.min.css><link rel=preload as=image href=https://anchetaWern.github.io/theme.png><link rel=preload as=image href=https://anchetaWern.github.io/twitter.svg><link rel=preload as=image href=https://anchetaWern.github.io/github.svg><link rel=preload as=image href=https://anchetaWern.github.io/instagram.svg><link rel=preload as=image href=https://anchetaWern.github.io/rss.svg><link rel=icon href=https://anchetaWern.github.io/favicon.ico><link rel=apple-touch-icon href=https://anchetaWern.github.io/apple-touch-icon.png><meta name=generator content="Hugo 0.110.0"><meta property="og:title" content="PHP Design Patterns: Singleton Pattern"><meta property="og:description" content="This is the 13th post in a series of articles that will walk you through how to implement design patterns in PHP.
In this part, we&rsquo;re going to take a look at how you can implement the Singleton Pattern.
The Singleton Pattern is a creational design pattern for ensuring that you&rsquo;re only ever working with a single instance of a class. This makes it very predictable in terms of the values it handles."><meta property="og:type" content="article"><meta property="og:url" content="https://anchetaWern.github.io/posts/singleton-pattern-in-php/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-02T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-02T00:00:00+00:00"><meta itemprop=name content="PHP Design Patterns: Singleton Pattern"><meta itemprop=description content="This is the 13th post in a series of articles that will walk you through how to implement design patterns in PHP.
In this part, we&rsquo;re going to take a look at how you can implement the Singleton Pattern.
The Singleton Pattern is a creational design pattern for ensuring that you&rsquo;re only ever working with a single instance of a class. This makes it very predictable in terms of the values it handles."><meta itemprop=datePublished content="2023-04-02T00:00:00+00:00"><meta itemprop=dateModified content="2023-04-02T00:00:00+00:00"><meta itemprop=wordCount content="602"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="PHP Design Patterns: Singleton Pattern"><meta name=twitter:description content="This is the 13th post in a series of articles that will walk you through how to implement design patterns in PHP.
In this part, we&rsquo;re going to take a look at how you can implement the Singleton Pattern.
The Singleton Pattern is a creational design pattern for ensuring that you&rsquo;re only ever working with a single instance of a class. This makes it very predictable in terms of the values it handles."></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href=https://anchetaWern.github.io/>Wern Ancheta</a>
<a class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]"></a></div><a class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"></a>
<script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg=`"#faf6f1"`.replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"><a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./twitter.svg) href=https://twitter.com/wernancheta target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/anchetaWern target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./instagram.svg) href=https://instagram.com/wernancheta target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./rss.svg) href=https://anchetaWern.github.io/index.xml target=_blank></a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 pb-32 dark:prose-invert"><article><header class=mb-20><h1 class="!my-0 pb-2.5">PHP Design Patterns: Singleton Pattern</h1><div class="text-sm opacity-60"><time>Apr 2, 2023</time>
<span class=mx-1>&#183;</span>
<span>Wern Ancheta</span></div></header><section><p>This is the 13th post in a series of articles that will walk you through how to implement design patterns in PHP.</p><p>In this part, we&rsquo;re going to take a look at how you can implement the Singleton Pattern.</p><p>The Singleton Pattern is a creational design pattern for ensuring that you&rsquo;re only ever working with a single instance of a class. This makes it very predictable in terms of the values it handles. Accessing it from different parts of your code will yield the same instance all the time.</p><p>You can use the Singleton Pattern anywhere where you only want to be working with a single class instance at any given time anywhere in your code base. A common example if a <code>Config</code> class which allows you to set and get different config properties for your entire application.</p><p>To prevent instantiation, you need to make the <code>constructor</code> into <code>private</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// singletonpattern/app/Config.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>SingletonPattern\App</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Config</span> 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#a6e22e>Config</span> $instance;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>array</span> $props <span style=color:#f92672>=</span> []; <span style=color:#75715e>// for storing config properties and their values
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> __construct() 
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This should prevent anyone from doing this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SingletonPattern\App\Config</span>();
</span></span></code></pre></div><p>And it would return an error that looks like this:</p><pre tabindex=0><code>Error: Call to private SingletonPattern\App\Config::__construct() from scope SingletonTest
</code></pre><p>To allow the client coder to use this class, we need to add a method for getting an instance of this class. Here, we first check if an instance already exists. If not, then we simply insantiate it from within the class and assign it to a local variable called <code>$intance</code>. Since an instance already exists, this variable will then be the one to be returned for subsequent times that the <code>getInstance()</code> method is called:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getInstance</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Config</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>(<span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$instance)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$instance <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>self</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$instance;
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>Next, add the methods for setting and getting properties. These can just be normal methods as they don&rsquo;t have to be <code>static</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setProp</span>(<span style=color:#a6e22e>string</span> $name, <span style=color:#a6e22e>string</span> $value)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>props</span>[$name] <span style=color:#f92672>=</span> $value; 
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getProp</span>(<span style=color:#a6e22e>string</span> $name)<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>props</span>[$name];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>At this point, we can now test out if our singleton class really works. First, we check that it can&rsquo;t be instantiated:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// singletonpattern/app/SingletonTest.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span> <span style=color:#66d9ef>__DIR__</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;/../vendor/autoload.php&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>PHPUnit\Framework\TestCase</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SingletonTest</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>TestCase</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test_singleton_cant_be_initialized</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>expectErrorMessage</span>(<span style=color:#e6db74>&#39;Call to private SingletonPattern\App\Config::__construct() from scope SingletonTest&#39;</span>);
</span></span><span style=display:flex><span>        $config <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SingletonPattern\App\Config</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can also check that the functionality it intended to implement really works:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test_singleton_works</span>() <span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $config <span style=color:#f92672>=</span> <span style=color:#a6e22e>SingletonPattern\App\Config</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>();
</span></span><span style=display:flex><span>    $config<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setProp</span>(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#e6db74>&#39;goku&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertEquals</span>($config<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getProp</span>(<span style=color:#e6db74>&#39;name&#39;</span>), <span style=color:#e6db74>&#39;goku&#39;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>And that it can&rsquo;t just be unset:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test_singleton_cant_be_unset</span>() <span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $config <span style=color:#f92672>=</span> <span style=color:#a6e22e>SingletonPattern\App\Config</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>();
</span></span><span style=display:flex><span>    $config<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setProp</span>(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#e6db74>&#39;vegeta&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>unset</span>($config);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $config2 <span style=color:#f92672>=</span> <span style=color:#a6e22e>SingletonPattern\App\Config</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>();
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertEquals</span>($config2<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getProp</span>(<span style=color:#e6db74>&#39;name&#39;</span>), <span style=color:#e6db74>&#39;vegeta&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Finally, test if the values in the <code>props</code> array are indeed overriden even if you store the reference on a different variable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test_singleton_is_really_single</span>() <span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $config <span style=color:#f92672>=</span> <span style=color:#a6e22e>SingletonPattern\App\Config</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>();
</span></span><span style=display:flex><span>    $config<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setProp</span>(<span style=color:#e6db74>&#39;wife&#39;</span>, <span style=color:#e6db74>&#39;bulma&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $config2 <span style=color:#f92672>=</span> <span style=color:#a6e22e>SingletonPattern\App\Config</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>();
</span></span><span style=display:flex><span>    $config2<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setProp</span>(<span style=color:#e6db74>&#39;wife&#39;</span>, <span style=color:#e6db74>&#39;chi-chi&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertNotEquals</span>($config<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getProp</span>(<span style=color:#e6db74>&#39;wife&#39;</span>), <span style=color:#e6db74>&#39;bulma&#39;</span>);
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertEquals</span>($config<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getProp</span>(<span style=color:#e6db74>&#39;wife&#39;</span>), <span style=color:#e6db74>&#39;chi-chi&#39;</span>);
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>To run this. Be sure to add the following on your <code>composer.json</code> file then run <code>composer dump-autoload</code>:</p><pre tabindex=0><code>&#34;autoload&#34;: {
    &#34;psr-4&#34;: {
        &#34;SingletonPattern\\App\\&#34;: &#34;singletonpattern/app/&#34;
    }
},
</code></pre><p>Also install phpunit (<code>composer require phpunit/phpunit</code>) if you haven&rsquo;t done so already.</p><p>You can then run it by executing the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vendor/bin/phpunit singletonpattern/app/SingletonTest.php
</span></span></code></pre></div><p>That&rsquo;s really all there is to the Singleton Pattern. It&rsquo;s a way to ensure that a class has only one globally available instance. A common usage for this pattern is for helper classes or storing config. Basically anything that doesn&rsquo;t need to work with different instances can be a singleton.</p><p>You can find the source code used in this tutorial on this <a href=https://github.com/anchetaWern/php-design-patterns>GitHub repo</a>.</p></section><nav class="mt-24 flex rounded-lg bg-black/[3%] p-1.5 text-lg dark:bg-white/[8%]"><a class="ml-auto flex w-1/2 items-center justify-end rounded-md p-6 pl-3 no-underline hover:bg-black/[2%]" href=https://anchetaWern.github.io/posts/bridge-design-pattern-in-php/><span>PHP Design Patterns: Bridge Pattern</span><span class=ml-1.5>→</span></a></nav></article></main><footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=https://anchetaWern.github.io/>Wern Ancheta</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>▷ Paper 6</a></footer></body></html>